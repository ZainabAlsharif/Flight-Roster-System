<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Plane View</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Font Awesome for icons -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <link rel="stylesheet" href="/public/styles/plane-view.css" />
</head>

<body>
  <div class="app-wrapper">
    <header class="main-header container">
      <div class="logo-container">
        <div class="airplane-icon">
          <svg viewBox="0 0 44 44" fill="none">
            <path d="M37.6933 7.16833C38.775 8.25 38.775 9.99167 37.6933 11.055L30.5617 18.1867L34.4483 35.035L31.8633 37.6383L24.75 24.0167L17.6 31.1667L18.26 35.695L16.2983 37.6383L13.0717 31.8083L7.22333 28.5633L9.16667 26.5833L13.75 27.2617L20.845 20.1667L7.22333 12.9983L9.82667 10.4133L26.675 14.3L33.8067 7.16833C34.8333 6.105 36.6667 6.105 37.6933 7.16833Z" fill="white" />
          </svg>
        </div>
        <h1 class="brand-name">FlyTech</h1>
      </div>

      <nav class="nav-container">
        <a class="nav-link" onclick="window.location.href='./about-us.html';">About Us</a>
        <a class="login-button" onclick="window.location.href='./login.html';">Log-in</a>
      </nav>
    </header>

    <main class="container">
      <div class="main-card">
        <div class="back-row">
          <button class="back-button" onclick="window.location.href='./assigned-flight-list.html';">
            <i class="fas fa-arrow-left" aria-hidden="true"></i>
          </button>
        </div>

        <div class="flight-info">
          <h2 class="flight-title">Flight: -</h2>
          <p class="flight-details">-</p>
        </div>

        <hr class="divider-line" />

        <div class="view-tabs">
          <div class="tab-item tab-active">
            <div class="tab-icon">
              <i class="fas fa-plane"></i>
            </div>
            <span>Plane View</span>
          </div>

          <div class="tab-item" onclick="navigateToTabularView()">
            <div class="tab-icon">
              <i class="fas fa-table"></i>
            </div>
            <span>Tabular View</span>
          </div>

          <div class="tab-item" onclick="navigateToExtendedView()">
            <div class="tab-icon">
              <i class="fas fa-list"></i>
            </div>
            <span>Extended View</span>
          </div>
        </div>
        
        <div class="planeWrap">
          <div class="seatMapCard">
            <div class="seatMapHeader">
              <div class="left">
                <div class="aircraft" id="aircraftTitle">Aircraft: -</div>
                <div class="hint muted" id="aircraftHint">Loading…</div>
              </div>
            </div>

            <div class="scrollArea">
              <div id="seatmap">
                <div class="muted seatmap-loading">Loading seat map…</div>
              </div>
            </div>

            <div class="err" id="errBox"></div>
          </div>

          <div class="seatDetails">
            <h2>Seat details</h2>
            <div class="body" id="seatDetailsBody">
              <div class="muted">Click a seat. Occupied seats show passenger info.</div>
            </div>
          </div>
        </div>

        <div class="export-container">
          <button class="export-button" id="exportJsonBtn" type="button">
            <div class="download-icon">
              <svg viewBox="0 0 28 28" fill="none">
                <path d="M14 18.6667L8.16667 12.8333L9.8 11.1417L12.8333 14.175V4.66667H15.1667V14.175L18.2 11.1417L19.8333 12.8333L14 18.6667ZM7 23.3333C6.35833 23.3333 5.80922 23.1051 5.35267 22.6485C4.89611 22.1919 4.66744 21.6424 4.66667 21V17.5H7V21H21V17.5H23.3333V21C23.3333 21.6417 23.1051 22.1912 22.6485 22.6485C22.1919 23.1058 21.6424 23.3341 21 23.3333H7Z" fill="#FEFFFF" />
              </svg>
            </div>
            <span class="export-text">Export JSON</span>
          </button>
        </div>
      </div>
    </main>
  </div>

  <script>
    let flightId = 1; // Assuming the flight ID is provided dynamically.

    // Fetch the flight data and seat map
    async function loadSeatMap() {
      const response = await fetch(`/api/seats/${flightId}`);
      const seats = await response.json();

      const seatmap = document.getElementById('seatmap');
      seatmap.innerHTML = ''; // Clear previous seat map

      seats.forEach(seat => {
        const seatButton = document.createElement('button');
        seatButton.classList.add('seat-btn', seat.isReserved ? 'reserved' : 'available');
        seatButton.textContent = seat.seatNumber;

        if (seat.isReserved) {
          seatButton.classList.add('removable');
          seatButton.onclick = () => removePassenger(seat.id);
        } else {
          seatButton.onclick = () => assignPassenger(seat.id);
        }

        seatmap.appendChild(seatButton);
      });
    }

    // Assign a passenger to an available seat
    async function assignPassenger(seatId) {
      const passengerName = prompt('Enter the passenger\'s name:');
      if (!passengerName) return;

      const response = await fetch(`/api/assign-seat/${seatId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ passengerName })
      });

      if (response.ok) {
        alert('Seat assigned successfully!');
        loadSeatMap();
      } else {
        alert('Error assigning seat!');
      }
    }

    // Remove a passenger from a reserved seat
    async function removePassenger(seatId) {
      const response = await fetch(`/api/remove-passenger/${seatId}`, {
        method: 'POST'
      });

      if (response.ok) {
        alert('Passenger removed successfully!');
        loadSeatMap();
      } else {
        alert('Error removing passenger!');
      }
    }

    // Load the seat map when the page is loaded
    window.addEventListener('DOMContentLoaded', () => {
      loadSeatMap();
    });
  </script>
</body>
</html>
